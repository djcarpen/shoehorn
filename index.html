<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Shoehorn : How to create Hive UDF in Scala">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Shoehorn</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/djcarpen/shoehorn">View on GitHub</a>

          <h1 id="project_title">Shoehorn</h1>
          <h2 id="project_tagline">How to create Hive UDF in Scala</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/djcarpen/shoehorn/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/djcarpen/shoehorn/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a id="abstract" class="anchor" href="#abstract" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Abstract</h3>

<p>This article will focus on creating a custom HIVE UDF in the Scala programming language. Intellij IDEA 2016 was used to create the project and artifacts. Creation and testing of the UDF was performed on the Hortonworks Sandbox 2.4 using Oracle Virtual Box.</p>

<h3>
<a id="create-project" class="anchor" href="#create-project" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create project.</h3>

<p>Using Intellij IDEA, create a new project with the following configuration.</p>

<ul>
<li>Project type: Scala</li>
<li>Project name: shoehorn</li>
<li>Project SDK: 1.8 (java version 1.8)</li>
<li>Scala SDK: scala-sdk-2.11.8</li>
</ul>

<h3>
<a id="create-package" class="anchor" href="#create-package" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create package</h3>

<p>Once the project is created, add a new package under /shoehorn/src/ named: udf</p>

<h3>
<a id="set-dependencies" class="anchor" href="#set-dependencies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Set dependencies</h3>

<p>Edit your project structure and add the <a href="http://repo1.maven.org/maven2/org/apache/hive/hive-exec/1.2.1/hive-exec-1.2.1.jar">hive-exec-1.2.1.jar</a> file to the module dependencies.</p>

<h3>
<a id="create-artifact" class="anchor" href="#create-artifact" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create Artifact</h3>

<p>Edit your project structure and add and artifact of type JAR&gt;module with dependencies. For this example, I am adding the artifact to the shoehorn module.</p>

<h3>
<a id="create-scala-class" class="anchor" href="#create-scala-class" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create Scala class</h3>

<p>The first thing we need to do is create a Scala class referencing the org.apache.hadoop.hive.ql.exec.UDF library. For this example, the class name is ScalaUDF. </p>

<pre><code>package udf

import org.apache.hadoop.hive.ql.exec.UDF

class ScalaUDF extends UDF {
}
</code></pre>

<h3>
<a id="define-function" class="anchor" href="#define-function" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Define function</h3>

<p>Now we add our function definition inside the ScalaUDF definition. For this example, I'm creating a simple function that takes an input column of string type and returns the length of that string. This function is for demonstration purposes only as there is already a Hive function that provides the same functionality. </p>

<pre><code>package udf

import org.apache.hadoop.hive.ql.exec.UDF

class ScalaUDF extends UDF {
  def evaluate(str: String): Int = {
    str.length()
  }
}
</code></pre>

<h3>
<a id="create-artifact-1" class="anchor" href="#create-artifact-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create artifact</h3>

<p>Using Intellij IDEA select Build&gt;"Make Project" from the file menu. Next, select Build&gt;"Build Artifacts...". This will create the /shoehorn/out/artifacts/shoehorn_jar/shoehorn.jar file.</p>

<h3>
<a id="create-hive-udf" class="anchor" href="#create-hive-udf" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create Hive UDF</h3>

<p>Upload the shoehorn.jar file to HDFS. You may need to change the file permissions depending on which user will be executing Hive commands. For this example, I've uploaded the file to my local Hortonworks Sandbox in the location: hdfs:///jars/shoehorn.jar</p>

<p>In hive, run the following command to register a new udf. Note: This can be done in the Hive view in Ambari or through the Hive CLI.</p>

<pre><code>create function getScalaLength as 'udf.ScalaUDF' using jar 'hdfs:///jars/shoehorn.jar';
</code></pre>

<p>Finally, we can test our udf using the following HQL in Hive.</p>

<pre><code>select phone_number, getScalaLength(phone_number) from xademo.customer_details limit 5;
</code></pre>

<p>The result set returned:</p>

<pre><code>PHONE_NUM   9
5553947406  10
7622112093  10
5092111043  10
9392254909  10
Time taken: 6.38 seconds, Fetched: 5 row(s)
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Shoehorn maintained by <a href="https://github.com/djcarpen">djcarpen</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
